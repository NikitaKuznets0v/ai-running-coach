# Changelog - AI Running Coach

Все заметные изменения в проекте документируются в этом файле.

---

## [0.3.0] - 2026-02-02

### Добавлено
- **Контекст активного плана** — бот теперь загружает активный план тренировок при каждом запросе и отвечает в его контексте
- **Конвертация темпа в скорость для дорожки** — автоматический перевод темпа (мин/км) в скорость (км/ч) для беговой дорожки
  - Формула: `скорость = 60 / темп_в_минутах`
  - Пример: 5:10/км = 11.6 км/ч
- **Новые ноды в workflow:**
  - `Get Active Plan` — загрузка активного плана из weekly_plans
  - `Merge User & Plan` — объединение данных пользователя с планом
- **Новый поток для существующих пользователей:** `User Not Found?(false) → Get Active Plan → Merge User & Plan → Prepare Data`

### Изменено
- **Prepare Data** обновлён для работы с контекстом плана
- System prompt теперь включает:
  - Активный план тренировок пользователя
  - Инструкции по конвертации темпа в скорость
  - Контекстные ответы на вопросы о тренировках

### Технические детали
- Workflow: `workflow-main-chatbot-v3.json`
- Деплой: n8n.kube.kontur.host
- ID воркфлоу: `OElc53ji11bXjJWq`

---

## [0.2.0] - 2026-02-01

### Добавлено
- **Расширенный онбординг** — новые этапы для разных типов целей:
  - `goal_type` — выбор типа цели (general/race/improvement)
  - `race_details` — сбор деталей забега (дистанция, дата, целевое время)
  - `improvement_details` — сбор целей по улучшению результатов
- **Умное извлечение данных** — бот извлекает всю информацию из одного сообщения и не переспрашивает
- **Сохранение истории чатов** в базу данных (chat_history)
- **Сохранение планов** в weekly_plans
- **Поддержка ultra дистанций** (30км+)

### Исправлено
- Ошибка парсинга Markdown в Telegram — теперь символы `* _ \` [ ]` заменяются на безопасные
- Ошибка "Node hasn't been executed" — исправлены ссылки между нодами

### Миграции базы данных
- `002_add_onboarding_stages.sql` — новые этапы онбординга
- Обновлён `schema.sql` с новыми этапами и ultra дистанцией

---

## [0.1.0] - 2026-01-27

### Добавлено
- Базовая структура проекта
- Онбординг пользователей (5 этапов)
- Генерация недельных планов тренировок
- AI-общение через GPT-4o mini
- Интеграция с Telegram Bot API
- База данных PostgreSQL (Supabase)
- N8N workflows для автоматизации

### Файлы
- `workflow-main-chatbot.json` — основной чатбот
- `workflow-plan-generator.json` — генерация планов
- `workflow-training-logger.json` — логирование тренировок
- `database/schema.sql` — схема БД
- Промпты для AI в `prompts/`

---

## Планируется

### [0.4.0] - Стратегия подготовки
- [ ] Долгосрочные стратегии для каждого типа цели:
  - **Race** — периодизация подготовки к забегу (базовый период → развитие → пик → тейпер)
  - **Improvement** — прогрессивное улучшение результатов
  - **General** — поддержание формы и здоровья
- [ ] Автоматический расчёт количества недель до цели
- [ ] Сохранение стратегии в БД
- [ ] Генерация недельных планов на основе стратегии
- [ ] Возможность спросить "Как я иду по стратегии?"
- [ ] Адаптация стратегии при отклонениях

### [0.5.0] - Улучшения UX
- [ ] Inline кнопки для частых действий
- [ ] Напоминания о тренировках
- [ ] Еженедельные сводки прогресса
- [ ] Статистика и аналитика

### [1.0.0] - Production Ready
- [ ] Месяц успешного тестирования
- [ ] Все критические баги исправлены
- [ ] Мониторинг и алерты
- [ ] Документация для пользователей

---

## Как читать версии

- **Major (X.0.0)** — большие изменения, возможно несовместимые
- **Minor (0.X.0)** — новые фичи, обратная совместимость
- **Patch (0.0.X)** — багфиксы и мелкие улучшения
