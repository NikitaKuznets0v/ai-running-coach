# Changelog - AI Running Coach

Все заметные изменения в проекте документируются в этом файле.

---

## [0.4.0] - 2026-02-02

### RACE-only + Профессиональные планы

Полный переход на специализацию по шоссейному бегу (road running).

### Добавлено
- **Специализация на шоссейном беге** — бот теперь работает только с подготовкой к классическим забегам (5К-ультрамарафон), трейлраннинг не поддерживается
- **Расширенный онбординг** — 9 этапов сбора данных:
  - `started` → `profile` → `physical` → `heart_rate` → `running_info` → `lab_testing` → `training_freq` → `race_details` → `strategy_preview` → `completed`
- **Пульс покоя** — вопрос с инструкцией измерения + опция "не знаю"
- **Лабораторное тестирование** — опциональный ввод VO2max и LTHR для продвинутых бегунов
- **Пульсовые зоны по Карвонену** — автоматический расчёт 5 зон:
  - Формула: `Target HR = ((Max HR − Resting HR) × %Intensity) + Resting HR`
  - Зона 1 (восстановление): 50-60%
  - Зона 2 (аэробная база): 60-70% — 80% тренировок!
  - Зона 3 (темповая): 70-80%
  - Зона 4 (пороговая): 80-90%
  - Зона 5 (VO2max): 90-100%
- **Стратегия подготовки** — генерация долгосрочного плана с периодизацией:
  - БАЗА → РАЗВИТИЕ → СПЕЦИАЛИЗАЦИЯ → ТЕЙПЕР
  - Автоматический расчёт недель до забега
- **Профессиональный формат тренировок:**
  - Разминка (10-15 мин): лёгкая трусца + динамическая растяжка
  - Основная часть: темп/скорость + пульсовая зона
  - Заминка (5-10 мин): лёгкая трусца + растяжка
- **Конвертация для дорожки** — все темпы автоматически переводятся в км/ч

### Изменено
- **Prepare Data** полностью переписан для RACE-only онбординга
- **Build Update Data** обновлён для новых полей
- **Check User** теперь загружает HR и lab testing данные
- **Update User Profile** сохраняет новые поля

### Миграции базы данных
- `003_add_hr_and_lab_testing.sql`:
  - Поля `resting_hr`, `max_hr`
  - Поля `has_lab_testing`, `vo2max`, `lthr`
  - Поля `hr_zone1_max` ... `hr_zone5_max`
  - Новые этапы онбординга

### Технические детали
- Workflow: `workflow-main-chatbot-v4.json`
- Деплой: n8n.kube.kontur.host
- ID воркфлоу: `IV3gYzEyGC6K9jXM`

---

## [0.3.0] - 2026-02-02

### Добавлено
- **Контекст активного плана** — бот загружает активный план при каждом запросе
- **Конвертация темпа в скорость** — автоматический перевод для беговой дорожки
- **Новые ноды:** Get Active Plan, Merge User & Plan

### Технические детали
- Workflow: `workflow-main-chatbot-v3.json` (удалён, заменён на v4)

---

## [0.2.0] - 2026-02-01

### Добавлено
- **Расширенный онбординг** — новые этапы для разных типов целей:
  - `goal_type` — выбор типа цели (general/race/improvement)
  - `race_details` — сбор деталей забега (дистанция, дата, целевое время)
  - `improvement_details` — сбор целей по улучшению результатов
- **Умное извлечение данных** — бот извлекает всю информацию из одного сообщения и не переспрашивает
- **Сохранение истории чатов** в базу данных (chat_history)
- **Сохранение планов** в weekly_plans
- **Поддержка ultra дистанций** (30км+)

### Исправлено
- Ошибка парсинга Markdown в Telegram — теперь символы `* _ \` [ ]` заменяются на безопасные
- Ошибка "Node hasn't been executed" — исправлены ссылки между нодами

### Миграции базы данных
- `002_add_onboarding_stages.sql` — новые этапы онбординга
- Обновлён `schema.sql` с новыми этапами и ultra дистанцией

---

## [0.1.0] - 2026-01-27

### Добавлено
- Базовая структура проекта
- Онбординг пользователей (5 этапов)
- Генерация недельных планов тренировок
- AI-общение через GPT-4o mini
- Интеграция с Telegram Bot API
- База данных PostgreSQL (Supabase)
- N8N workflows для автоматизации

### Файлы
- `workflow-main-chatbot.json` — основной чатбот
- `workflow-plan-generator.json` — генерация планов
- `workflow-training-logger.json` — логирование тренировок
- `database/schema.sql` — схема БД
- Промпты для AI в `prompts/`

---

## Планируется

### [0.5.0] - Улучшения UX
- [ ] Inline кнопки для частых действий
- [ ] Напоминания о тренировках
- [ ] Еженедельные сводки прогресса
- [ ] Статистика и аналитика

### [1.0.0] - Production Ready
- [ ] Месяц успешного тестирования
- [ ] Все критические баги исправлены
- [ ] Мониторинг и алерты
- [ ] Документация для пользователей
- [ ] **Rate limiting** — ограничение количества сообщений/токенов на пользователя (защита от злоупотребления AI-чатом)

---

## Как читать версии

- **Major (X.0.0)** — большие изменения, возможно несовместимые
- **Minor (0.X.0)** — новые фичи, обратная совместимость
- **Patch (0.0.X)** — багфиксы и мелкие улучшения
