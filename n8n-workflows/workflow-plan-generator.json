{
  "name": "AI Running Coach - Plan Generator",
  "meta": {
    "instanceId": "ai-running-coach-plan-gen"
  },
  "nodes": [
    {
      "id": "workflow-trigger",
      "name": "When Called by Main Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [0, 300],
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "user_id",
              "type": "string"
            },
            {
              "name": "user_profile",
              "type": "string"
            },
            {
              "name": "chat_id",
              "type": "number"
            }
          ]
        }
      },
      "typeVersion": 1.1
    },
    {
      "id": "parse-user-profile",
      "name": "Parse User Profile",
      "type": "n8n-nodes-base.set",
      "position": [220, 300],
      "parameters": {
        "mode": "manual",
        "duplicateItem": false,
        "assignments": {
          "assignments": [
            {
              "id": "user_id",
              "name": "user_id",
              "type": "string",
              "value": "={{ $json.user_id }}"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "type": "number",
              "value": "={{ $json.chat_id }}"
            },
            {
              "id": "profile",
              "name": "profile",
              "type": "object",
              "value": "={{ JSON.parse($json.user_profile) }}"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 3.4
    },
    {
      "id": "get-last-week-plan",
      "name": "Get Last Week Plan",
      "type": "n8n-nodes-base.supabase",
      "position": [440, 300],
      "parameters": {
        "operation": "getAll",
        "tableId": "weekly_plans",
        "returnAll": false,
        "limit": 1,
        "filterType": "string",
        "filterString": "user_id=eq.{{ $json.user_id }}&order=week_start.desc"
      },
      "typeVersion": 1,
      "credentials": {
        "supabaseApi": {
          "id": "SUPABASE_CREDENTIALS_ID",
          "name": "Supabase"
        }
      }
    },
    {
      "id": "get-last-week-trainings",
      "name": "Get Last Week Trainings",
      "type": "n8n-nodes-base.supabase",
      "position": [660, 300],
      "parameters": {
        "operation": "getAll",
        "tableId": "trainings",
        "returnAll": true,
        "filterType": "string",
        "filterString": "user_id=eq.{{ $('Parse User Profile').item.json.user_id }}&date=gte.{{ $now.minus({days: 7}).format('yyyy-MM-dd') }}"
      },
      "typeVersion": 1,
      "credentials": {
        "supabaseApi": {
          "id": "SUPABASE_CREDENTIALS_ID",
          "name": "Supabase"
        }
      }
    },
    {
      "id": "prepare-plan-context",
      "name": "Prepare Plan Context",
      "type": "n8n-nodes-base.set",
      "position": [880, 300],
      "parameters": {
        "mode": "manual",
        "duplicateItem": false,
        "assignments": {
          "assignments": [
            {
              "id": "user_id",
              "name": "user_id",
              "type": "string",
              "value": "={{ $('Parse User Profile').item.json.user_id }}"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "type": "number",
              "value": "={{ $('Parse User Profile').item.json.chat_id }}"
            },
            {
              "id": "profile",
              "name": "profile",
              "type": "object",
              "value": "={{ $('Parse User Profile').item.json.profile }}"
            },
            {
              "id": "last_plan",
              "name": "last_plan",
              "type": "object",
              "value": "={{ $('Get Last Week Plan').item.json || null }}"
            },
            {
              "id": "last_week_trainings",
              "name": "last_week_trainings",
              "type": "object",
              "value": "={{ $('Get Last Week Trainings').all().map(i => i.json) }}"
            },
            {
              "id": "week_start",
              "name": "week_start",
              "type": "string",
              "value": "={{ $now.startOf('week').plus({days: 1}).format('yyyy-MM-dd') }}"
            },
            {
              "id": "week_end",
              "name": "week_end",
              "type": "string",
              "value": "={{ $now.startOf('week').plus({days: 7}).format('yyyy-MM-dd') }}"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 3.4
    },
    {
      "id": "calculate-zones",
      "name": "Calculate Pace Zones",
      "type": "n8n-nodes-base.code",
      "position": [1100, 300],
      "parameters": {
        "jsCode": "// Calculate pace zones based on 5K pace\nconst profile = $input.item.json.profile;\nconst pace5k = profile.current_5k_pace_seconds || 360; // default 6:00/km\n\n// Pace zones (seconds per km)\n// Based on Jack Daniels' running formula simplified\nconst zones = {\n  zone1: Math.round(pace5k * 1.25), // Recovery - 25% slower\n  zone2: Math.round(pace5k * 1.15), // Easy - 15% slower  \n  zone3: Math.round(pace5k * 1.05), // Tempo - 5% slower\n  zone4: pace5k,                     // Interval - at 5K pace\n  zone5: Math.round(pace5k * 0.95)  // Sprint - 5% faster\n};\n\n// Format pace as MM:SS\nfunction formatPace(seconds) {\n  const mins = Math.floor(seconds / 60);\n  const secs = seconds % 60;\n  return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    zones: zones,\n    zones_formatted: {\n      zone1: formatPace(zones.zone1),\n      zone2: formatPace(zones.zone2),\n      zone3: formatPace(zones.zone3),\n      zone4: formatPace(zones.zone4),\n      zone5: formatPace(zones.zone5)\n    },\n    // Calculate last week summary\n    last_week_summary: {\n      total_km: $input.item.json.last_week_trainings.reduce((sum, t) => sum + (t.distance_km || 0), 0),\n      total_sessions: $input.item.json.last_week_trainings.length,\n      avg_feeling: $input.item.json.last_week_trainings.length > 0 \n        ? $input.item.json.last_week_trainings.filter(t => t.feeling).map(t => t.feeling).join(', ')\n        : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'\n    },\n    // Calculate week number in training cycle\n    week_number: $input.item.json.last_plan \n      ? ($input.item.json.last_plan.week_number || 0) + 1 \n      : 1\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "ai-generate-plan",
      "name": "AI Generate Plan",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [1400, 300],
      "parameters": {
        "promptType": "define",
        "text": "–°–æ–∑–¥–∞–π –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.",
        "hasOutputParser": false,
        "options": {
          "systemMessage": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –±–µ–≥–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤.\n\n–ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:\n- –£—Ä–æ–≤–µ–Ω—å: {{ $json.profile.level || 'intermediate' }}\n- –¶–µ–ª—å: {{ $json.profile.goal || 'general' }}\n- –¢–µ–∫—É—â–∏–π —Ç–µ–º–ø 5–∫–º: {{ $json.zones_formatted.zone4 }}/–∫–º\n- –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é: {{ $json.profile.weekly_runs || 3 }}\n- –¢–∏–ø: {{ $json.profile.training_type || 'outdoor' }}\n{{ $json.profile.race_distance ? '- –î–∏—Å—Ç–∞–Ω—Ü–∏—è –∑–∞–±–µ–≥–∞: ' + $json.profile.race_distance : '' }}\n{{ $json.profile.race_date ? '- –î–∞—Ç–∞ –∑–∞–±–µ–≥–∞: ' + $json.profile.race_date : '' }}\n\n–ó–û–ù–´ –¢–ï–ú–ü–ê:\n- Zone 1 (Recovery): {{ $json.zones_formatted.zone1 }}/–∫–º\n- Zone 2 (Easy): {{ $json.zones_formatted.zone2 }}/–∫–º\n- Zone 3 (Tempo): {{ $json.zones_formatted.zone3 }}/–∫–º\n- Zone 4 (Interval): {{ $json.zones_formatted.zone4 }}/–∫–º\n- Zone 5 (Sprint): {{ $json.zones_formatted.zone5 }}/–∫–º\n\n–ü–†–û–®–õ–ê–Ø –ù–ï–î–ï–õ–Ø:\n- –í—Å–µ–≥–æ –∫–º: {{ $json.last_week_summary.total_km }}\n- –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {{ $json.last_week_summary.total_sessions }}\n- –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ: {{ $json.last_week_summary.avg_feeling }}\n\n–¢–ï–ö–£–©–ê–Ø –ù–ï–î–ï–õ–Ø –¶–ò–ö–õ–ê: {{ $json.week_number }}\n\n–ü–†–ê–í–ò–õ–ê:\n1. 80% –ª–µ–≥–∫–∏—Ö, 20% –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\n2. –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞\n3. –ù–∏–∫–æ–≥–¥–∞ 2 —Ç—è–∂–µ–ª—ã—Ö –¥–Ω—è –ø–æ–¥—Ä—è–¥\n4. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –Ω–µ –±–æ–ª–µ–µ 10% –æ—Ç –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏\n5. –ü–æ—Å–ª–µ 3-4 –Ω–µ–¥–µ–ª—å —Ä–æ—Å—Ç–∞ ‚Äî –Ω–µ–¥–µ–ª—è —Ä–∞–∑–≥—Ä—É–∑–∫–∏\n\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n{\n  \"monday\": {\"type\": \"—Ç–∏–ø\", \"distance_km\": —á–∏—Å–ª–æ, \"duration_minutes\": —á–∏—Å–ª–æ, \"pace_range\": \"M:SS-M:SS\", \"notes\": \"–∑–∞–º–µ—Ç–∫–∏\", \"completed\": false},\n  \"tuesday\": {...},\n  ...\n  \"sunday\": {...},\n  \"summary\": {\"total_distance_km\": —á–∏—Å–ª–æ, \"total_sessions\": —á–∏—Å–ª–æ, \"week_focus\": \"–æ–ø–∏—Å–∞–Ω–∏–µ\"}\n}\n\n–¢–∏–ø—ã: rest, easy_run, long_run, tempo, intervals, recovery, fartlek",
          "maxIterations": 3
        }
      },
      "typeVersion": 1.7
    },
    {
      "id": "openai-model-plan",
      "name": "OpenAI Model (Plan)",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [1320, 520],
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {
          "temperature": 0.5,
          "responseFormat": "json_object"
        }
      },
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "OPENAI_CREDENTIALS_ID",
          "name": "OpenAI"
        }
      }
    },
    {
      "id": "parse-plan-json",
      "name": "Parse Plan JSON",
      "type": "n8n-nodes-base.code",
      "position": [1620, 300],
      "parameters": {
        "jsCode": "// Parse the AI response to extract JSON\nlet output = $input.item.json.output || $input.item.json.text || '';\n\n// Try to extract JSON from the response\nlet planData;\ntry {\n  // If output is already an object\n  if (typeof output === 'object') {\n    planData = output;\n  } else {\n    // Try to find JSON in the string\n    const jsonMatch = output.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      planData = JSON.parse(jsonMatch[0]);\n    } else {\n      throw new Error('No JSON found in response');\n    }\n  }\n} catch (e) {\n  // Return error response\n  return {\n    json: {\n      error: true,\n      message: 'Failed to parse plan: ' + e.message,\n      raw_output: output\n    }\n  };\n}\n\n// Calculate totals if not provided\nconst days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\nlet totalDistance = 0;\nlet totalSessions = 0;\n\ndays.forEach(day => {\n  if (planData[day] && planData[day].type !== 'rest') {\n    totalDistance += planData[day].distance_km || 0;\n    totalSessions++;\n  }\n});\n\nif (!planData.summary) {\n  planData.summary = {};\n}\nplanData.summary.total_distance_km = planData.summary.total_distance_km || totalDistance;\nplanData.summary.total_sessions = planData.summary.total_sessions || totalSessions;\n\nreturn {\n  json: {\n    plan_data: planData,\n    total_distance_km: planData.summary.total_distance_km,\n    total_sessions: planData.summary.total_sessions,\n    user_id: $('Calculate Pace Zones').item.json.user_id,\n    chat_id: $('Calculate Pace Zones').item.json.chat_id,\n    week_start: $('Calculate Pace Zones').item.json.week_start,\n    week_end: $('Calculate Pace Zones').item.json.week_end,\n    week_number: $('Calculate Pace Zones').item.json.week_number\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "check-parse-error",
      "name": "Check Parse Error",
      "type": "n8n-nodes-base.if",
      "position": [1840, 300],
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "error-check",
              "operator": {
                "type": "boolean",
                "operation": "true"
              },
              "leftValue": "={{ $json.error }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2.2
    },
    {
      "id": "save-plan",
      "name": "Save Plan to DB",
      "type": "n8n-nodes-base.supabase",
      "position": [2060, 400],
      "parameters": {
        "operation": "create",
        "tableId": "weekly_plans",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $json.user_id }}"
            },
            {
              "fieldId": "week_start",
              "fieldValue": "={{ $json.week_start }}"
            },
            {
              "fieldId": "week_end",
              "fieldValue": "={{ $json.week_end }}"
            },
            {
              "fieldId": "week_number",
              "fieldValue": "={{ $json.week_number }}"
            },
            {
              "fieldId": "plan_data",
              "fieldValue": "={{ JSON.stringify($json.plan_data) }}"
            },
            {
              "fieldId": "total_distance_km",
              "fieldValue": "={{ $json.total_distance_km }}"
            },
            {
              "fieldId": "total_sessions",
              "fieldValue": "={{ $json.total_sessions }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "active"
            }
          ]
        }
      },
      "typeVersion": 1,
      "credentials": {
        "supabaseApi": {
          "id": "SUPABASE_CREDENTIALS_ID",
          "name": "Supabase"
        }
      }
    },
    {
      "id": "format-plan-message",
      "name": "Format Plan Message",
      "type": "n8n-nodes-base.code",
      "position": [2280, 400],
      "parameters": {
        "jsCode": "const planData = $('Parse Plan JSON').item.json.plan_data;\nconst summary = planData.summary || {};\n\n// Day names in Russian\nconst dayNames = {\n  monday: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',\n  tuesday: '–í—Ç–æ—Ä–Ω–∏–∫',\n  wednesday: '–°—Ä–µ–¥–∞',\n  thursday: '–ß–µ—Ç–≤–µ—Ä–≥',\n  friday: '–ü—è—Ç–Ω–∏—Ü–∞',\n  saturday: '–°—É–±–±–æ—Ç–∞',\n  sunday: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'\n};\n\n// Training type emojis\nconst typeEmojis = {\n  rest: 'üò¥',\n  easy_run: 'üèÉ',\n  long_run: 'üèÉ‚Äç‚ôÇÔ∏è',\n  tempo: '‚ö°',\n  intervals: 'üî•',\n  recovery: 'üåø',\n  fartlek: 'üéØ'\n};\n\n// Format the plan message\nlet message = `üìã *–ü–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é*\\n`;\nmessage += `(${$('Parse Plan JSON').item.json.week_start} ‚Äî ${$('Parse Plan JSON').item.json.week_end})\\n\\n`;\n\nconst days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\n\ndays.forEach(day => {\n  const workout = planData[day];\n  if (!workout) return;\n  \n  const emoji = typeEmojis[workout.type] || 'üìå';\n  const dayName = dayNames[day];\n  \n  if (workout.type === 'rest') {\n    message += `${emoji} *${dayName}*: –û—Ç–¥—ã—Ö\\n`;\n  } else {\n    message += `${emoji} *${dayName}*: `;\n    if (workout.distance_km) message += `${workout.distance_km} –∫–º`;\n    if (workout.pace_range) message += ` @ ${workout.pace_range}`;\n    message += `\\n`;\n    if (workout.notes) message += `   _${workout.notes}_\\n`;\n  }\n});\n\nmessage += `\\nüìä *–ò—Ç–æ–≥–æ:* ${summary.total_distance_km || 0} –∫–º –∑–∞ ${summary.total_sessions || 0} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫`;\nif (summary.week_focus) {\n  message += `\\nüéØ *–§–æ–∫—É—Å –Ω–µ–¥–µ–ª–∏:* ${summary.week_focus}`;\n}\n\nmessage += `\\n\\n‚úÖ –ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –£–¥–∞—á–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫! üí™`;\n\nreturn {\n  json: {\n    output: message,\n    chat_id: $('Parse Plan JSON').item.json.chat_id\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "error-message",
      "name": "Error Message",
      "type": "n8n-nodes-base.set",
      "position": [2060, 200],
      "parameters": {
        "mode": "manual",
        "duplicateItem": false,
        "assignments": {
          "assignments": [
            {
              "id": "output",
              "name": "output",
              "type": "string",
              "value": "–ò–∑–≤–∏–Ω–∏, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É. üôè"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "type": "number",
              "value": "={{ $('Calculate Pace Zones').item.json.chat_id }}"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 3.4
    },
    {
      "id": "merge-output",
      "name": "Merge Output",
      "type": "n8n-nodes-base.merge",
      "position": [2500, 300],
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "typeVersion": 3
    },
    {
      "id": "sticky-note-1",
      "name": "Sticky Note - Info",
      "type": "n8n-nodes-base.stickyNote",
      "position": [-200, 150],
      "parameters": {
        "color": 4,
        "width": 350,
        "height": 200,
        "content": "## AI Running Coach - Plan Generator\n\n**–≠—Ç–æ—Ç sub-workflow:**\n1. –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ—à–ª—ã–µ –¥–∞–Ω–Ω—ã–µ\n3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–æ–Ω—ã —Ç–µ–º–ø–∞\n4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–ª–∞–Ω —á–µ—Ä–µ–∑ AI\n5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î\n6. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–ª—è Telegram"
      },
      "typeVersion": 1
    },
    {
      "id": "sticky-note-2",
      "name": "Sticky Note - Science",
      "type": "n8n-nodes-base.stickyNote",
      "position": [-200, 400],
      "parameters": {
        "color": 7,
        "width": 350,
        "height": 200,
        "content": "## –ü—Ä–∏–Ω—Ü–∏–ø—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞\n\n- 80/20 –ø—Ä–∞–≤–∏–ª–æ (–ª–µ–≥–∫–∏–µ/–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ)\n- –ü—Ä–∞–≤–∏–ª–æ 10% (–ø—Ä–∏—Ä–æ—Å—Ç –æ–±—ä–µ–º–∞)\n- –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å –æ—Ç–¥—ã—Ö–∞\n- –ù–µ 2 —Ç—è–∂–µ–ª—ã—Ö –¥–Ω—è –ø–æ–¥—Ä—è–¥\n- –ó–æ–Ω—ã —Ç–µ–º–ø–∞ –ø–æ Jack Daniels"
      },
      "typeVersion": 1
    }
  ],
  "connections": {
    "When Called by Main Workflow": {
      "main": [
        [
          {
            "node": "Parse User Profile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse User Profile": {
      "main": [
        [
          {
            "node": "Get Last Week Plan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Last Week Plan": {
      "main": [
        [
          {
            "node": "Get Last Week Trainings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Last Week Trainings": {
      "main": [
        [
          {
            "node": "Prepare Plan Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Plan Context": {
      "main": [
        [
          {
            "node": "Calculate Pace Zones",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Pace Zones": {
      "main": [
        [
          {
            "node": "AI Generate Plan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model (Plan)": {
      "ai_languageModel": [
        [
          {
            "node": "AI Generate Plan",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Generate Plan": {
      "main": [
        [
          {
            "node": "Parse Plan JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Plan JSON": {
      "main": [
        [
          {
            "node": "Check Parse Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Parse Error": {
      "main": [
        [
          {
            "node": "Error Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Save Plan to DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Plan to DB": {
      "main": [
        [
          {
            "node": "Format Plan Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Plan Message": {
      "main": [
        [
          {
            "node": "Merge Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Message": {
      "main": [
        [
          {
            "node": "Merge Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "AI Running Coach"
    },
    {
      "name": "Sub-workflow"
    }
  ],
  "triggerCount": 1,
  "active": false
}
